# EZtView（mcq）操作使用指导

> 适用对象：PC 端业务人员、实施、运维。<br>
> 参考来源：界面截图（`./实操截图/`）、前端 `mcq-front-pc/`、后端 `mcq/`、OAuth2 `iam/`。

## 目录
- 概览与登录
- 账号与权限
- 项目管理
- 项目配置
  - 项目应用（应用市场/排序/配置）
  - 组织 / 成员 / 角色
  - EZtCloud 资源（设备类型 / 设备 / 模型关联）
  - 项目操作指引
- 工作台（组织应用）
  - 电能看板、变压器、配电回路、用电终端、中央空调、照明系统、设备监控、能耗浪费、能耗统计、预付费、告警信息等
- 常用操作流程
- OAuth2 单点登录说明
- 常见问题

---

## 概览与登录
1. 打开登录页，点击“立即登录”进入统一认证。  
   ![登录页](./实操截图/10登录/10登录页.png)
2. 选择登录方式（账号/手机号/邮箱）并完成验证码校验。  
   ![登录方式](./实操截图/10登录/20登陆方式.png)
   ![登录方式补充](./实操截图/10登录/20登陆方式1.png)
3. 尚未注册时，可在认证页完成**注册**（支持手机号 / 邮箱），并绑定手机与邮箱便于找回密码。  
   ![注册入口](./实操截图/10登录/11注册.png)
   ![手机号注册](./实操截图/10登录/12手机号注册.png)
   ![邮箱注册](./实操截图/10登录/13邮箱注册.png)
4. 系统跳转 IAM OAuth2 授权页，授权后回跳 EZtView 并获取访问令牌。
5. 登录成功后，可选择平台或直接进入“我的项目”列表。  
   ![平台选择](./实操截图/10登录/30平台选择.png)
   ![项目列表快捷入口](./实操截图/10登录/39项目列表.png)
   ![账号设置入口](./实操截图/10登录/50账号设置.png)
   ![账号设置-资料](./实操截图/10登录/60账号设置.png)

> 登录实现参考：前端 `src/views/login/index.vue` 通过 `/api/v1/iam/login/spa/` 跳转；后端 IAM `/api/v1/iam/oauth/token/` 发放 token。

### 找回密码
- 入口：登录页“忘记密码”或直接访问 `/#/forgetPsd`。
- 若已绑定手机号/邮箱，可在账号设置中更换或绑定。  
  ![更换与绑定](./实操截图/10登录/70手机号和电子邮箱更换和绑定.png)

---

## 账号与权限
- 权限模型：路由 `meta.permissions` 控制菜单展示，示例 `view_projects`、`view_projectsappmenus` 等。
- 典型角色：
  - 系统管理员：全局管理。
  - 项目管理员：项目配置、成员、角色、应用。
  - 组织管理员：组织下应用与设备。
  - 业务查看/操作：按应用模块分配。

---

## 项目管理
入口：`/#/myproject`

1. **创建项目**
   - 点击“点击此处添加项目”。
   - 填写项目名称、所属组织等。
2. **项目列表**
   - “我创建的项目”与“我加入的项目”分栏，支持排序。
   - 卡片显示设备数、成员数；点击进入项目。
3. **项目详情快速入口**
   - 项目卡片右上角工具图标可查看项目配置与详情。

截图参考：
- 项目列表：![项目列表](./实操截图/20创建,加入项目/10项目列表.png)
- 创建项目：![创建项目](./实操截图/20创建,加入项目/20创建项目.png)
- 项目详情：![项目详情](./实操截图/20创建,加入项目/21项目详情.png)
- 项目排序：![项目排序](./实操截图/20创建,加入项目/22项目排序.png)
- 进入项目：![进入项目](./实操截图/20创建,加入项目/30进入项目.png)

---

## 项目配置
进入路径：`/#/<projectId>/projectconfig/...`

### 1) 项目应用（应用市场与排序）
- 路径：`projectconfig/appconfig`
- 已添加应用列表支持拖拽排序；可编辑显示名称、移除（部分应用不可移除，如告警）。
- 应用市场：未添加的应用可一键“添加”，常用 appKey：
  - `electricEnergy` 电能看板
  - `transformer` 变压器
  - `distributionTesting` 配电回路
  - `smartTerminal`/`circuitBreaker` 物联网断路器
  - `lighting` 照明
  - `energyWaste` 能耗浪费
  - `energyConsumptionStatistics` 能耗统计
  - `prepayment` 预付费
  - `warningGessage` 告警信息
- 配置入口：卡片内“配置”跳转到对应应用配置页。
  
截图参考：
- 项目应用总览：![项目应用](./实操截图/30项目设置/30项目应用.png)
- 选择组织：![选择组织](./实操截图/30项目设置/30项目配置/00/2选择组织.png)
- 应用市场：![应用市场](./实操截图/20项目设置/50选择项目应用.png)

### 2) 组织
- 路径：`projectconfig/orgconfig`
- 维护组织树，支持增删改查。
截图：
- 组织列表：![组织](./实操截图/30项目设置/90组织.png)
- 添加子组织：![添加子组织](./实操截图/30项目设置/110添加子组织.png)
- 修改组织名称：![修改组织名称](./实操截图/30项目设置/91修改组织名称.png)

### 3) 成员
- 路径：`projectconfig/userconfig`
- 添加成员、分配组织、分配角色。
截图：
- 成员列表：![成员](./实操截图/30项目设置/130成员.png)
- 邀请成员：![邀请成员](./实操截图/30项目设置/140邀请成员.png)

### 4) 角色
- 路径：`projectconfig/roleconfig`
- 维护项目级角色，分配权限点。
截图：
- 角色列表：![角色](./实操截图/30项目设置/80角色.png)
- 新建角色：![添加角色](./实操截图/30项目设置/81添加角色.png)

### 5) EZtCloud 资源
- 设备类型：`/:id/ezt/devicetype`（增删改，上传图标）
  - 截图：![设备类型](./实操截图/30项目设置/40EZtCloud资源-设备类型.png)
  - 添加/删除：![设备类型操作](./实操截图/30项目设置/50设备类型添加和删除.png)
- 设备：`/:id/ezt/device`（创建设备、绑定类型）
  - 截图：![设备](./实操截图/30项目设置/60EZtCloud资源-设备.png)
  - 添加/删除：![设备操作](./实操截图/30项目设置/61设备添加和删除.png)
- 模型关联：`/:id/ezt/model`（设备类型与模型映射）
  - 截图：![模型关联](./实操截图/30项目设置/70EZtCloud资源-模型关联.png)
  - 校验示例：![模型校验](./实操截图/30项目设置/71模型关联.png)

### 6) 操作指引
- 路径：`/:id/overview/`
- 展示项目内各应用的操作流程与说明。
截图：![操作指引](./实操截图/30项目设置/10操作指引.png)

---

## 工作台（组织应用）
入口：`/#/<projectId>/orgApp/<orgId>/...`，需先选择项目和组织。

常用模块与全部截图（逐屏指引）：

- **电能看板** `energyBoard`  
  - 总览：![电能看板](./实操截图/40工作台-项目应用/10电能看板/10电能看板.png)  
  - 全屏展示：![电能看板全屏](./实操截图/40工作台-项目应用/10电能看板/20电能看板全屏.png)

- **变压器监测** `transformer`  
  - 总览：![变压器](./实操截图/40工作台-项目应用/20变压器/10变压器.png)  
  - 负载率图表：![负载率](./实操截图/40工作台-项目应用/20变压器/20负载率-图表.png)  
  - 能耗年月日：![能耗-年月日](./实操截图/40工作台-项目应用/20变压器/30能耗-年月日.png)  
  - 实时数据-更多：![实时数据更多](./实操截图/40工作台-项目应用/20变压器/40实时数据-更多.png)  
  - 日原始数据：![日原始数据](./实操截图/40工作台-项目应用/20变压器/50日原始数据.png)

- **配电回路** `distributionTesting`  
  - 总览：![配电回路](./实操截图/40工作台-项目应用/30配电回路/10配电回路.png)  
  - 设备状态：![设备状态](./实操截图/40工作台-项目应用/30配电回路/20设备状态.png)  
  - 日原始数据-日期：![日原始数据-日期](./实操截图/40工作台-项目应用/30配电回路/30日原始数据-日期.png)  
  - 日原始数据：![日原始数据](./实操截图/40工作台-项目应用/30配电回路/30日原始数据.png)  
  - 能耗日-月-年：![能耗日月年](./实操截图/40工作台-项目应用/30配电回路/40能耗日-月-年.png)

- **用电终端** `smartTerminal`  
  - 总览：![用电终端](./实操截图/40工作台-项目应用/40用电终端/10用电终端.png)  
  - 参数选择：![参数选择](./实操截图/40工作台-项目应用/40用电终端/100参数选择.png)  
  - 时间选择：![时间选择](./实操截图/40工作台-项目应用/40用电终端/110时间选择.png)  
  - 展示方式：![展示方式](./实操截图/40工作台-项目应用/40用电终端/11展示方式.png)  
  - 展开：![展开](./实操截图/40工作台-项目应用/40用电终端/20展开.png)  
  - 设备分组筛选：![分组筛选](./实操截图/40工作台-项目应用/40用电终端/30设备分组筛选.png)  
  - 刷新：![刷新](./实操截图/40工作台-项目应用/40用电终端/40刷新.png)  
  - 设备控制：![设备控制](./实操截图/40工作台-项目应用/40用电终端/50设备控制.png)  
  - 详情：![详情](./实操截图/40工作台-项目应用/40用电终端/60详情.png)  
  - 控制日志：![控制日志](./实操截图/40工作台-项目应用/40用电终端/70控制日志.png)  
  - 更多-实时数据：![更多实时数据](./实操截图/40工作台-项目应用/40用电终端/80更多-实时数据.png)  
  - 更多参数提示：![更多参数提示](./实操截图/40工作台-项目应用/40用电终端/90单击此处查看更多参数图标.png)

- **中央空调** `HVAC`  
  - 空调内机：![空调内机](./实操截图/40工作台-项目应用/50中央空调/10空调内机.png)  
  - 设备分组筛选：![分组筛选](./实操截图/40工作台-项目应用/50中央空调/20设备分组筛选.png)  
  - 空调控制：![空调控制](./实操截图/40工作台-项目应用/50中央空调/30空调控制.png)  
  - 锁定控制：![锁定控制](./实操截图/40工作台-项目应用/50中央空调/40锁定控制.png)  
  - 批量控制：![批量控制](./实操截图/40工作台-项目应用/50中央空调/50批量控制.png)

- **照明系统** `lighting`  
  - 总览：![照明系统](./实操截图/40工作台-项目应用/60照明系统/10照明系统.png)  
  - 详情：![详情](./实操截图/40工作台-项目应用/60照明系统/20详情.png)  
  - 亮度设定：![亮度设定](./实操截图/40工作台-项目应用/60照明系统/30亮度设定.png)

- **设备监控** `environment` / 设备监控  
  - 总览：![设备监控系统](./实操截图/40工作台-项目应用/70设备监控/10设备监控系统.png)  
  - 分布图更换：![分布图更换](./实操截图/40工作台-项目应用/70设备监控/20分布图更换.png)  
  - 设备管理：![设备管理](./实操截图/40工作台-项目应用/70设备监控/30设备管理.png)  
  - 详情：![监控详情](./实操截图/40工作台-项目应用/70设备监控/40详情.png)

- **能耗浪费** `energyWaste`  
  - 概览：![能耗浪费概览](./实操截图/40工作台-项目应用/80能耗浪费/10概览.png)  
  - 报表：![报表](./实操截图/40工作台-项目应用/80能耗浪费/20报表.png)  
  - 图表展示与导出：![图表导出](./实操截图/40工作台-项目应用/80能耗浪费/30图表展示-导出.png)

- **能耗统计** `energyConsumptionStatistics`  
  - 用能概况：![用能概况](./实操截图/40工作台-项目应用/90能耗统计/10用能概况.png)  
  - 用能统计：![用能统计](./实操截图/40工作台-项目应用/90能耗统计/20用能统计.png)  
  - 同比分析：![同比分析](./实操截图/40工作台-项目应用/90能耗统计/30同比分析.png)  
  - 环比分析：![环比分析](./实操截图/40工作台-项目应用/90能耗统计/40环比分析.png)  
  - 电能集抄：![电能集抄](./实操截图/40工作台-项目应用/90能耗统计/50电能集抄.png)  
  - 对比分析：![对比分析](./实操截图/40工作台-项目应用/90能耗统计/60对比分析.png)  
  - 不同节点对比：![不同节点对比](./实操截图/40工作台-项目应用/90能耗统计/60对比分析-不同节点对比.png)  
  - 能耗排名：![能耗排名](./实操截图/40工作台-项目应用/90能耗统计/61能耗排名.png)

- **预付费** `prepayment`  
- 预付费入口：![预付费](./实操截图/20项目设置/93设备.png)  （配置与工作台均复用）

- **告警信息** `warningGessage`  
- 告警列表：![告警信息](./实操截图/40工作台-项目应用/100告警信息.png)

---

## 常用操作流程（步骤指引）

### A. 新建项目并配置应用
1. `我的项目` → “点击此处添加项目”，填写名称并创建。
2. 进入项目后，`项目应用` → 在应用市场添加所需模块 → 拖拽排序。
3. 如需组织级应用，确保已创建组织并分配成员/角色。

### B. 配置组织与成员
1. `组织`：创建组织节点（支持多级）。
2. `成员`：添加成员，选择所属组织与角色。
3. `角色`：为不同岗位配置权限点（如 `view_projectsappmenus`、`view_device` 等）。

### C. 设备与模型管理
1. `设备类型`：创建类型并上传图标。
2. `设备`：批量/单个新增设备，选择设备类型。
3. `模型关联`：在“模型关联”将设备类型与数据模型绑定，确保数据上报解析。

### D. 应用配置示例（配电回路）
1. `项目应用` → 找到“配电回路” → 配置。
2. 进入应用配置页，添加分组、绑定设备、配置数据源。
3. 在工作台打开“配电回路”，查看实时状态与能耗分析。

### E. 预付费管理
1. 在应用市场添加“预付费”，并在 `项目应用` 已添加列表中进入配置。
2. `电表管理`：导入/新增电表，绑定价格策略。
3. `充值记录 / 扣费记录 / 事件记录 / 操作记录`：按组织与时间过滤。

---

## OAuth2 单点登录说明
- 前端跳转：`/api/v1/iam/login/spa/?next=<目标页>&redirect_uri=<callback>`。
- 回调页：`/oauth/callback.html`（静态页，处理 code/state）。
- Token 获取：POST `/api/v1/iam/oauth/token/`，成功后写入 `sessionStorage`：`jwt_access` / `jwt_refresh`。
- 刷新：`/api/v1/iam/token/refresh/v2/`。
- 登录态校验：前端路由守卫读取 token，不存在则跳转登录并附带 `redirect`。

---

## 常见问题
- **登录后空白或 403**：确认项目 ID/组织 ID 正确、权限点（如 `view_projects`、`view_orgtree`）已分配。
- **应用不显示**：检查项目应用是否已添加，路由 `meta.show` 及权限 `permissions`。
- **设备数据为空**：确认设备已绑定类型与模型，数据上报通道正常。
- **预付费扣费异常**：检查价格配置与电表绑定，查看事件/操作记录。
- **看板无数据**：检查组织选择、时间范围、维度配置。

---

## 术语对照
- 项目（Project）：业务隔离单元。
- 组织（Org）：项目内的树形组织/站点。
- 应用（App / appKey）：业务功能模块，可按项目添加。
- 设备类型 / 设备：资产分类与实例。
- 模型关联：设备类型与数据模型映射，用于解析与展示。
- 预付费：计费/充值/扣费管理。
- 告警信息：设备/系统告警汇总。

---

如需补充特定场景或截图，请告知项目/组织及应用模块名称。***

